<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
<title>EzC Signature App</title>
<style>
*{box-sizing:border-box;}
body{margin:0;font-family:system-ui;background:#eaeef3;}
.app{max-width:420px;margin:auto;min-height:100vh;background:#fff;}
.page{padding:16px;}
h3{text-align:center;}
label{display:block;margin-top:14px;font-weight:600;}
input, textarea, select{
 width:100%;
 padding:14px;
 margin-top:6px;
 border-radius:12px;
 border:1px solid #ccc;
 font-size:16px;
 -webkit-text-size-adjust:100%;
 line-height:1.4;
}
button{width:100%;padding:14px;margin-top:14px;border:none;border-radius:14px;font-size:16px;color:#fff;}
.next-btn{background:#27ae60;}
.clear-btn{background:#e74c3c;}
.pay-btn{background:#2980b9;}
.whatsapp-btn{background:#25D366;}
.info-btn{background:#8e44ad;}

canvas{width:100%;height:160px;border:2px dashed #aaa;border-radius:12px;margin-top:8px;touch-action:none;}

.statement{margin-top:12px;padding:12px;background:#f4f6f8;border-radius:12px;font-size:14px;}

#page2{display:none;}

#loading{
 position:fixed;inset:0;
 background:rgba(255,255,255,.96);
 display:none;
 flex-direction:column;
 align-items:center;
 justify-content:center;
 z-index:999;
 text-align:center;
}

.spinner{
 width:48px;height:48px;
 border:5px solid #ddd;
 border-top:5px solid #27ae60;
 border-radius:50%;
 animation:spin 1s linear infinite;
 margin-bottom:16px;
}

@keyframes spin{100%{transform:rotate(360deg);}}

/* Progress Bar Styles */
.progress-container {
  width: 100%;
  height: 18px;
  background: #eee;
  border-radius: 9px;
  margin-top: 20px;
  overflow: hidden;
  position: relative;
}
.progress-bar {
  width: 0%;
  height: 100%;
  background: #27ae60;
  border-radius: 9px;
  transition: width 0.3s ease-in-out;
}
.progress-num {
  position:absolute;
  top:0;
  left:50%;
  transform:translateX(-50%);
  font-size:12px;
  color:#000;
  font-weight:600;
}
</style>
</head>
<body>
<div class="app">

<!-- PAGE 1 -->
<div class="page" id="page1">
<h3>Customer Details</h3>

<label>Name</label>
<input id="name">
<label>NIC</label>
<input id="nic">
<label>Amount (Rs)</label>
<input type="number" id="amount">

<div class="statement">
‡∂∏‡∑è ‡∑Ä‡∑í‡∑É‡∑í‡∂±‡∑ä ‡∂Ω‡∂∂‡∑è‡∂ú‡∂±‡∑ä‡∂±‡∑è ‡∂∏‡∑ô‡∂∏ ‡∂∏‡∑î‡∂Ø‡∂Ω, ‡∂±‡∑í‡∂∫‡∂∏‡∑í‡∂≠ ‡∂ö‡∑ú‡∂±‡∑ä‡∂Ø‡∑ö‡∑É‡∑í ‡∑Ä‡∂Ω‡∂ß ‡∂ë‡∂ö‡∂ü‡∑Ä ‡∂ú‡∑ô‡∑Ä‡∑ì‡∂∏‡∂ß ‡∂¥‡∑ú‡∂ª‡∑ú‡∂±‡∑ä‡∂Ø‡∑î ‡∑Ä‡∑ô‡∂∏‡∑í.
</div>

<!-- Signature Options -->
<label>Draw Signature</label>
<canvas id="sign"></canvas>
<button class="clear-btn" onclick="clearSign()">Clear Signature</button>

<label>Or Upload Signature Image</label>
<input type="file" id="signUpload" accept="image/*">

<button class="next-btn" onclick="goNext()">Next</button>

<!-- Page 1 Progress Bar -->
<div class="progress-container">
  <div class="progress-bar" id="progress1"></div>
  <div class="progress-num" id="progressNum1">0%</div>
</div>
</div>

<!-- PAGE 2 -->
<div class="page" id="page2">
<h3>Loan Approved</h3>

<p><b>Customer ID:</b> <span id="customerId"></span></p>
<p><b>Amount:</b> Rs. <span id="showAmount"></span></p>
<p><b>Insurance:</b> Rs. <span id="insurance"></span></p>

<div class="statement">
‡∂ª‡∂ö‡∑ä‡∑Ç‡∂´ ‡∂∏‡∑î‡∂Ø‡∂Ω ‡∂ú‡∑ô‡∑Ä‡∑ì‡∂∏‡∑ô‡∂±‡∑ä ‡∂¥‡∑É‡∑î ‡∂¥‡∑ê‡∂∫‡∂ö‡∑ä ‡∂á‡∂≠‡∑î‡∑Ö‡∂≠ ‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä ‡∂∂‡∑ê‡∂ª ‡∂ö‡∑ô‡∂ª‡∑ö.
</div>

<label>Upload Receipt</label>
<input type="file" id="receiptUpload">

<button class="info-btn" onclick="openInsuranceInfo()">Insurance Payment ‡∑Ñ‡∑ö‡∂≠‡∑î‡∑Ä</button>
<button class="pay-btn" onclick="payNow()">Pay Now</button>
<button class="whatsapp-btn" onclick="sendWhatsApp()">WhatsApp ‡∂∏‡∂ú‡∑í‡∂±‡∑ä ‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª ‡∂∫‡∑Ä‡∂±‡∑ä‡∂±</button>

<!-- Page 2 Progress Bar -->
<div class="progress-container">
  <div class="progress-bar" id="progress2"></div>
  <div class="progress-num" id="progressNum2">0%</div>
</div>
</div>
</div>

<!-- LOADING -->
<div id="loading">
 <div class="spinner"></div>
 <div id="loadingText">Loading...</div>
</div>

<script>
const PAY_LINK="https://example.com/pay";
const INSURANCE_INFO_LINK="https://example.com/insurance-info";
const WHATSAPP_NO="94742089009";
let EZ_ID="";

/* INSURANCE CALC */
function calculateInsurance(a){
 a=parseInt(a);
 if(a>=30000 && a<=50000) return 2700;
 if(a>50000 && a<=100000) return 3000;
 if(a>100000 && a<=200000) return 3500;
 if(a>200000 && a<=300000) return 4000;
 if(a>300000 && a<=400000) return 4500;
 if(a>400000 && a<=500000) return 5000;
 return 0;
}

/* SIGNATURE PAD */
const c=document.getElementById("sign");
const ctx=c.getContext("2d");
function resizeCanvas(){
 const r=c.getBoundingClientRect();
 const ratio=window.devicePixelRatio||1;
 c.width=r.width*ratio;
 c.height=r.height*ratio;
 ctx.setTransform(ratio,0,0,ratio,0,0);
 ctx.lineWidth=2.5;
 ctx.lineCap="round";
}
resizeCanvas();
let draw=false;
c.onpointerdown=e=>{draw=true;ctx.beginPath();ctx.moveTo(e.offsetX,e.offsetY);}
c.onpointermove=e=>{if(draw){ctx.lineTo(e.offsetX,e.offsetY);ctx.stroke();}}
c.onpointerup=()=>draw=false;
c.onpointerleave=()=>draw=false;
function clearSign(){
 ctx.clearRect(0,0,c.width,c.height);
 resizeCanvas();
}

/* Upload Signature Image */
const signUpload=document.getElementById("signUpload");
signUpload.addEventListener("change", e=>{
 const file=e.target.files[0];
 if(!file) return;
 const img=new Image();
 img.onload=()=>{
   ctx.clearRect(0,0,c.width,c.height);
   ctx.drawImage(img,0,0,c.width,c.height);
 }
 img.src=URL.createObjectURL(file);
});

/* PAGE 1 AUTO SCROLL */
const nameEl=document.getElementById("name");
const nicEl=document.getElementById("nic");
const amountEl=document.getElementById("amount");
function scrollToEl(el){setTimeout(()=>el.scrollIntoView({behavior:"smooth",block:"center"}),150);}
nameEl.addEventListener("change",()=>{if(nameEl.value.length>2) scrollToEl(nicEl);});
nicEl.addEventListener("change",()=>{if(nicEl.value.length>5) scrollToEl(amountEl);});
amountEl.addEventListener("change",()=>{if(amountEl.value>0) scrollToEl(c);});

/* PROGRESS BAR ANIMATION */
function animateProgressBar(barId,numId,start=0,end=100,duration=2000){
  const bar=document.getElementById(barId);
  const num=document.getElementById(numId);
  let startTime=null;
  function step(timestamp){
    if(!startTime) startTime=timestamp;
    const progress=Math.min((timestamp-startTime)/duration,1);
    const value=start + (end-start)*progress;
    bar.style.width=value+"%";
    num.innerText=Math.floor(value)+"%";
    if(progress<1) window.requestAnimationFrame(step);
  }
  window.requestAnimationFrame(step);
}

/* NEXT PAGE */
function goNext(){
 if(!nameEl.value||!nicEl.value||!amountEl.value){
  alert("‡∂ö‡∂ª‡∑î‡∂´‡∑è‡∂ö‡∂ª ‡∑É‡∑í‡∂∫‡∂Ω‡∑î fields ‡∂¥‡∑î‡∂ª‡∑Ä‡∂±‡∑ä‡∂±");
  return;
 }
 animateProgressBar("progress1","progressNum1",60,100,3000);
 loading.style.display="flex";
 loadingText.innerText="‡∑Ä‡∑í‡∑É‡∑ä‡∂≠‡∂ª upload ‡∂ö‡∂ª‡∂∏‡∑í‡∂±‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑ì...";
 setTimeout(()=>loadingText.innerText="‡∂´‡∂∫ ‡∂∏‡∑î‡∂Ø‡∂Ω‡∑ä ‡∂Ω‡∂∂‡∑è ‡∂ú‡∑ê‡∂±‡∑ì‡∂∏‡∂ß ‡∂â‡∂Ø‡∑í‡∂ª‡∑í ‡∂¥‡∑í‡∂∫‡∑Ä‡∂ª complete ‡∂ö‡∂ª‡∂∏‡∑í‡∂±‡∑ä...",5000);
 setTimeout(()=>{
  loading.style.display="none";
  page1.style.display="none";
  page2.style.display="block";
  EZ_ID="EZ-"+Date.now();
  customerId.innerText=EZ_ID;
  showAmount.innerText=amountEl.value;
  insurance.innerText=calculateInsurance(amountEl.value);
  setTimeout(()=>page2.scrollIntoView({behavior:"smooth"}),200);
  animateProgressBar("progress2","progressNum2",60,90,2000);
 },8000);
}

/* REAL-TIME RECEIPT UPLOAD PROGRESS */
const receiptInput=document.getElementById("receiptUpload");
receiptInput.addEventListener("change",e=>{
 const file=e.target.files[0];
 if(!file) return;
 const reader=new FileReader();
 reader.onprogress=evt=>{
   if(evt.lengthComputable){
     let percent=Math.floor((evt.loaded/evt.total)*100);
     if(percent<90) percent=60+Math.floor((percent/100)*30);
     progressBarUpdate(percent);
   }
 }
 reader.onloadend=()=>{progressBarUpdate(100);}
 reader.readAsArrayBuffer(file);
});
function progressBarUpdate(percent){
 const bar=document.getElementById("progress2");
 const num=document.getElementById("progressNum2");
 bar.style.width=percent+"%";
 num.innerText=percent+"%";
}

/* PAY BUTTON */
function payNow(){
 loading.style.display="flex";
 loadingText.innerText="Payment gateway load ‡∑Ä‡∑ô‡∂∏‡∑í‡∂±‡∑ä ‡∂¥‡∑Ä‡∂≠‡∑ì...";
 setTimeout(()=>{
  loading.style.display="none";
  window.open(PAY_LINK,"_blank");
 },2000);
}

/* WHATSAPP BUTTON */
function sendWhatsApp(){
 const msg=`üìÑ Loan Details
Customer ID: ${EZ_ID}
Amount: Rs.${showAmount.innerText}
Insurance: Rs.${insurance.innerText}
Time: ${new Date().toLocaleString()}`;
 window.open(`https://wa.me/${WHATSAPP_NO}?text=${encodeURIComponent(msg)}`);
}

/* INSURANCE INFO */
function openInsuranceInfo(){
 window.open(INSURANCE_INFO_LINK,"_blank");
}
</script>
</body>
</html>
