<!DOCTYPE html>
<html lang="si">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>EzC Signature App</title>

<style>
*{box-sizing:border-box}
body{margin:0;font-family:system-ui;background:#eaeef3}
.app{max-width:420px;margin:auto;min-height:100vh;background:#fff}
.page{padding:16px}
h3{text-align:center}
label{display:block;margin-top:14px;font-weight:600}

input{
 width:100%;
 padding:14px;
 margin-top:6px;
 border-radius:12px;
 border:1px solid #ccc;
 font-size:16px
}

button{
 width:100%;
 padding:14px;
 margin-top:14px;
 border:none;
 border-radius:14px;
 font-size:16px;
 color:#fff
}

.next-btn{background:#27ae60}
.clear-btn{background:#e74c3c}
.pay-btn{background:#2980b9}
.whatsapp-btn{background:#25D366}
.info-btn{background:#8e44ad}

canvas{
 width:100%;
 height:160px;
 border:2px dashed #aaa;
 border-radius:12px;
 margin-top:8px;
 touch-action:none
}

.statement{
 margin-top:12px;
 padding:12px;
 background:#f4f6f8;
 border-radius:12px;
 font-size:14px
}

#page2{display:none}

#loading{
 position:fixed;inset:0;
 background:#fff;
 display:none;
 align-items:center;
 justify-content:center;
 flex-direction:column;
 z-index:999
}
</style>
</head>

<body>
<div class="app">

<!-- PAGE 1 -->
<div class="page" id="page1">
<h3>Customer Details</h3>

<label>Name</label>
<input id="nameInput">

<label>NIC</label>
<input id="nicInput">

<label>Amount (Rs)</label>
<input type="number" id="amountInput">

<div class="statement">
මා විසින් ලබා ගන්නා මෙම මුදල දී ඇති කාල වකවානුව වලට අනුව ගෙවීම කරන බව මෙයින් පොරොන්දු වෙමි.<br><br>
කිසිදු වංචාවක් සිදු නොකරන බවට ද අදාල පොලී අනුපාතයන් වලට අනුව ගෙවන බව පොරොන්දු වෙමි.
</div>

<label>Signature</label>
<canvas id="sign"></canvas>
<button class="clear-btn" onclick="clearSign()">Clear Signature</button>

<button class="next-btn" onclick="goNext()">Next</button>
</div>

<!-- PAGE 2 -->
<div class="page" id="page2">
<h3>Loan Approved</h3>

<p><b>Customer ID:</b> <span id="cid"></span></p>
<p><b>Amount:</b> Rs. <span id="amtShow"></span></p>
<p><b>Insurance:</b> Rs. <span id="insShow"></span></p>

<div class="statement">
මෙම රක්ෂණ මුදල ගෙවීම් කිරීම අනිවාර්යයි.<br><br>
රක්ෂණ මුදල ගෙවූ පසු ඔබගේ ණය මුදල පැයක් වැනි කාලයක් ඇතුළත ඔබගේ ගිණුමට ලැබේ.<br><br>
රක්ෂණ මුදල ගෙවූ රිසිට් පත upload කරන්න.
</div>

<label>Upload Receipt</label>
<input type="file" id="receiptInput" accept="image/*,application/pdf">

<button class="next-btn" onclick="submitDetails()">Submit</button>
</div>

</div>

<div id="loading">
 <p id="loadingText">Processing...</p>
</div>

<script>
/* DOM REFERENCES */
const nameEl = document.getElementById("nameInput");
const nicEl = document.getElementById("nicInput");
const amountEl = document.getElementById("amountInput");
const receiptEl = document.getElementById("receiptInput");

/* SIGNATURE */
const canvas = document.getElementById("sign");
const ctx = canvas.getContext("2d");
let drawing=false, hasSignature=false;

function resizeCanvas(){
 const r=canvas.getBoundingClientRect();
 canvas.width=r.width;
 canvas.height=r.height;
 ctx.lineWidth=2.5;
 ctx.lineCap="round";
}
resizeCanvas();

canvas.onpointerdown=e=>{
 drawing=true; hasSignature=true;
 ctx.beginPath(); ctx.moveTo(e.offsetX,e.offsetY);
}
canvas.onpointermove=e=>{
 if(!drawing) return;
 ctx.lineTo(e.offsetX,e.offsetY); ctx.stroke();
}
canvas.onpointerup=()=>drawing=false;
canvas.onpointerleave=()=>drawing=false;

function clearSign(){
 hasSignature=false;
 ctx.clearRect(0,0,canvas.width,canvas.height);
}

/* INSURANCE */
function calcIns(a){
 a=parseInt(a);
 if(a<=50000) return 2700;
 if(a<=100000) return 3000;
 if(a<=200000) return 3500;
 return 0;
}

/* NEXT */
function goNext(){
 if(!nameEl.value || !nicEl.value || !amountEl.value){
  alert("සියලු fields පුරවන්න");
  return;
 }
 if(!hasSignature){
  alert("Signature එක දාන්න");
  return;
 }

 document.getElementById("page1").style.display="none";
 document.getElementById("page2").style.display="block";

 document.getElementById("cid").innerText="EZ-"+Date.now();
 document.getElementById("amtShow").innerText=amountEl.value;
 document.getElementById("insShow").innerText=calcIns(amountEl.value);
}

/* SUBMIT – 100% FIXED */
function submitDetails(){
 if(!receiptEl.files || receiptEl.files.length === 0){
  alert("රිසිට් පත upload කරන්න");
  return;
 }
 alert("Submission සාර්ථකයි ✔️");
}
</script>

</body>
</html>
